{{ form_start(form) }}
{{ form_row(form.title) }}
{{ form_row(form.description) }}
{{ form_row(form.image) }}
<div class="load_image">
	<h5>
	Imagem selecionada: 
	</h5>
	<img height="100">
</div>
{{ form_row(form.stock) }}
{{ form_end(form) }}

<script>
	$(".load_image").hide();
	$("#product_image").on("blur", function() {
		let validate = true;

		let image = new Image();

		image.onload = function() {
			let url_image = $("#product_image").val();
			let type = url_image.substr(-3);
			if(type == "jpg" || type == "png" || type == "gif") {
				if(getImageSizeInBytes(url_image) <= 5) {
					$(".load_image img").attr("src", $("#product_image").val());
					$(".load_image").show();
				} else {
					alert("Tamanho superior a 5MB!");
					$(".load_image").hide();
					$("#product_image").val("");
				}
			} else {
				alert("Formato de imagem inválido!");
				$(".load_image").hide();
				$("#product_image").val("");
			}
		}

		image.onerror = function() {
			$(".load_image").hide();
			$("#product_image").val("");

			alert("URL da imagem é inexistente!");
		}

		image.src = $("#product_image").val();
	});

	function getImageSizeInBytes(imgURL) {
    var request = new XMLHttpRequest();
    request.open("HEAD", imgURL, false);
    request.send(null);
    var headerText = request.getAllResponseHeaders();
    var re = /Content\-Length\s*:\s*(\d+)/i;
    re.exec(headerText);
    return parseInt(RegExp.$1) / (1024 * 1024);
	}
</script>
